apiVersion: v1
kind: ConfigMap
metadata:
  name: dashboard-init-script
  namespace: dashboards
data:
  init-config.sh: |
    #!/bin/sh
    # Generates config.js from environment variables (K3s secrets)
    
    cat > /app/public/config.js << EOF
    // config.js - Generated by K3s init container
    window.__DASHBOARD_CONFIG__ = {
      openWeatherMapApiKey: "${OPENWEATHERMAP_API_KEY}",
      openWeatherMapLocation: "${OPENWEATHERMAP_LOCATION}",
      nextcloudUrl: "${NEXTCLOUD_URL}",
      nextcloudUser: "${NEXTCLOUD_USER}",
      nextcloudPassword: "${NEXTCLOUD_PASSWORD}",
      prometheusUrl: "${PROMETHEUS_URL}"
    };
    EOF
    
    echo "âœ“ Config.js generated successfully"
    cat /app/public/config.js